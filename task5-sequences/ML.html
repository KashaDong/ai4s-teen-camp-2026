<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœºå™¨å­¦ä¹ æ ¸å¿ƒèŒƒå¼ï¼šå­¦åšèœçš„æ™ºæ…§</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            line-height: 1.4; color: #2c3e50; max-width: 1000px; margin: 15px auto; padding: 0 15px; 
            background-color: #f8f9fa;
        }
        h1, h2 { color: #2c3e50; border-bottom: 1px solid #3498db; padding-bottom: 6px; margin: 10px 0; }
        .container { background: #ffffff; padding: 15px; border-radius: 6px; box-shadow: 0 1px 4px rgba(0,0,0,0.05); margin-bottom: 12px; }
        
        /* ç´§å‡‘çš„æ ¸å¿ƒè¦ç´ æ ·å¼ */
        .core-paradigm { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 15px; border-radius: 6px; margin: 10px 0;
            text-align: center;
        }
        .paradigm-title { 
            font-size: 1.3em; margin-bottom: 5px;
        }
        
        /* ç´§å‡‘çš„ç½‘æ ¼å¸ƒå±€ */
        .paradigm-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr;
            gap: 12px; 
            margin-top: 12px;
        }
        .theory-card, .practice-card { 
            padding: 12px; border-radius: 6px; 
            background: white; border: 1px solid #e9ecef;
        }
        .theory-card { border-left: 3px solid #3498db; }
        .practice-card { border-left: 3px solid #27ae60; }
        
        /* ç´§å‡‘çš„æ»‘å—å’ŒæŒ‰é’® */
        .sliders { margin: 10px 0; }
        .slider-group { margin: 8px 0; }
        .slider-group label { 
            display: flex; align-items: center; margin-bottom: 4px; font-weight: bold; 
            color: #2c3e50; font-size: 0.85em;
        }
        .slider-icon {
            font-size: 1.2em; margin-right: 6px;
        }
        .slider-group input[type="range"] {
            width: 100%; height: 4px; border-radius: 2px;
            background: #dfe6e9; outline: none;
        }
        
        .taste-result {
            font-size: 0.95em; font-weight: bold; padding: 8px;
            border-radius: 4px; margin: 6px 0; text-align: center;
            transition: all 0.2s ease;
        }
        
        /* è¯„åˆ†å’Œé‡ç½®æŒ‰é’®æ”¾åœ¨æ»‘å—ä¸‹æ–¹ */
        .control-row {
            display: flex; 
            align-items: center;
            justify-content: space-between;
            background: #f8f9fa; padding: 8px 12px; border-radius: 4px; 
            margin: 8px 0; border: 1px solid #e9ecef;
            font-size: 0.9em;
        }
        .score-display {
            display: flex; align-items: center;
        }
        .status-icon { 
            font-size: 1.2em; margin-right: 6px;
        }
        .status-value { 
            font-size: 1em; font-weight: bold; color: #3498db;
            font-family: 'Courier New', monospace;
            margin-left: 4px;
        }
        
        /* ä¼˜åŒ–å¯¹æ¯”æ ·å¼æ”¹è¿› */
        .optimization-comparison { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; 
            margin: 10px 0;
        }
        .method { 
            padding: 10px; border-radius: 4px; text-align: center;
            background: white; border: 1px solid #e9ecef;
            font-size: 0.85em;
        }
        .random-method { 
            border-top: 2px solid #e74c3c; 
            background: linear-gradient(135deg, #fff 0%, #fef0ef 100%);
        }
        .smart-method { 
            border-top: 2px solid #27ae60; 
            background: linear-gradient(135deg, #fff 0%, #f0f9f0 100%);
        }
        
        .progress-tracker { 
            margin: 6px 0; max-height: 120px; overflow-y: auto;
            background: #f8f9fa; padding: 6px; border-radius: 3px;
            font-size: 0.8em;
        }
        .progress-step {
            padding: 4px; margin: 2px 0; border-radius: 2px;
            background: #e9ecef; font-size: 0.8em;
            font-family: 'Courier New', monospace;
        }
        .progress-step.active { background: #3498db; color: white; }
        .progress-step.improved { background: #27ae60; color: white; }
        .progress-step.worse { background: #e74c3c; color: white; }
        
        .method-stats {
            margin: 6px 0; padding: 4px;
            background: #f8f9fa; border-radius: 3px;
            font-size: 0.8em;
        }
        
        button { 
            background-color: #3498db; color: white; border: none; 
            padding: 6px 12px; border-radius: 3px; cursor: pointer; 
            font-size: 0.85em; margin: 2px; font-weight: 500;
        }
        button:hover { background-color: #2980b9; }
        
        .status-display { 
            margin: 6px 0; padding: 6px; border-radius: 3px; 
            background: #f8f9fa; font-size: 0.85em;
            text-align: center; font-family: 'Courier New', monospace;
        }
        
        .math-formula {
            background: #f8f9fa; padding: 8px; border-radius: 3px;
            text-align: center; margin: 6px 0; border: 1px solid #e9ecef;
            font-size: 0.9em;
        }

        .optimizing .control-row {
            background: #fff3cd; border-color: #ffeaa7;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { background: #fff3cd; }
            50% { background: #ffeaa7; }
            100% { background: #fff3cd; }
        }

        .summary-box {
            background: #e8f4f8; padding: 15px; border-radius: 6px;
            margin: 10px 0; border-left: 4px solid #3498db;
            font-size: 1em;
            line-height: 1.5;
        }

        .algorithm-explanation {
            font-size: 0.85em; color: #666;
            margin: 5px 0; line-height: 1.3;
        }

        .cooking-analogy {
            background: #fff8e1; padding: 10px; border-radius: 4px;
            margin: 8px 0; border-left: 3px solid #ffa000;
            font-size: 0.85em;
            line-height: 1.5;
        }
        .analogy-item {
            margin: 6px 0;
            padding-left: 8px;
            border-left: 2px solid #ffa000;
        }

        /* å‹ç¼©ç¬¬äºŒæ¨¡å—æ ·å¼ */
        .compact-section {
            margin: 5px 0;
        }
        .compact-button {
            margin-top: 8px;
        }

        /* ç»“æœæç¤ºè¯­æ ·å¼ */
        .result-message {
            margin: 4px 0;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.8em;
        }
        .random-result {
            background: #fdedec;
            border-left: 3px solid #e74c3c;
        }
        .smart-result {
            background: #d5f4e6;
            border-left: 3px solid #27ae60;
        }
    </style>
</head>
<body>

    <h1>æœºå™¨å­¦ä¹ æ ¸å¿ƒèŒƒå¼ï¼šä»å­¦åšèœç†è§£AIæ€ç»´</h1>
    
    <div class="core-paradigm">
        <div class="paradigm-title">æœºå™¨å­¦ä¹ ä¸‰å¤§æ ¸å¿ƒè¦ç´ </div>
        <div style="font-size: 0.9em; opacity: 0.9;">å†³ç­–å‡½æ•° Â· æŸå¤±å‡½æ•° Â· ä¼˜åŒ–ç®—æ³•</div>
    </div>

    <div class="container">
        <h2>1. å†³ç­–å‡½æ•°ï¼šæœºå™¨çš„"è°ƒå‘³å…¬å¼"</h2>
        
        <div class="paradigm-grid">
            <div class="theory-card">
                <h4>ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ</h4>
                <p><strong>å†³ç­–å‡½æ•°</strong>æ˜¯æœºå™¨å­¦ä¹ æ¨¡å‹è¿›è¡Œé¢„æµ‹çš„æ•°å­¦è§„åˆ™ã€‚</p>
                <div class="math-formula">
                    \(\hat{Z} = p \cdot Y - q \cdot X\)
                </div>
                <p>åœ¨çƒ¹é¥ªä¸­ï¼Œè¿™ç›¸å½“äºï¼š</p>
                <div class="math-formula">
                    é¢„æµ‹å‘³é“ = p Ã— è”¬èœé‡ - q Ã— è‚¥è‚‰é‡
                </div>
                <p>å…¶ä¸­ï¼š</p>
                <ul style="font-size: 0.9em; margin: 8px 0; padding-left: 20px;">
                    <li>p = ç›ç”¨é‡ï¼ˆæå‡è”¬èœé£å‘³ï¼‰</li>
                    <li>q = é†‹ç”¨é‡ï¼ˆè§£è‚¥è‚‰æ²¹è…»ï¼‰</li>
                    <li>Y = è”¬èœé‡ï¼ŒX = è‚¥è‚‰é‡</li>
                </ul>
            </div>
            
            <div class="practice-card">
                <h4>ğŸ”§ è°ƒæ•´è°ƒå‘³</h4>

                <div class="taste-result" id="tastePrediction">
                    å‘³é“ä¸­æ€§ ğŸ˜
                </div>
                
                <div class="sliders">
                    <div class="slider-group">
                        <label>
                            <span class="slider-icon">ğŸ§‚</span>
                            ç›ç”¨é‡ p: <span id="pValue">1.00</span>
                        </label>
                        <input type="range" id="pSlider" min="0.5" max="2.5" step="0.01" value="1.0">
                    </div>
                    <div class="slider-group">
                        <label>
                            <span class="slider-icon">ğŸ‹</span>
                            é†‹ç”¨é‡ q: <span id="qValue">1.00</span>
                        </label>
                        <input type="range" id="qSlider" min="0.5" max="2.5" step="0.01" value="1.0">
                    </div>
                </div>

                <!-- è¯„åˆ†å’Œé‡ç½®æŒ‰é’®ç§»åˆ°æ»‘å—ä¸‹æ–¹ -->
                <div class="control-row" id="recipeStatus">
                    <div class="score-display">
                        <span class="status-icon">ğŸ“Š</span>
                        <span>å½“å‰é…æ–¹è¯„åˆ†ï¼š</span>
                        <span class="status-value" id="currentScore">-</span>
                    </div>
                    <button id="resetRecipe">é‡ç½®é…æ–¹</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>2. æŸå¤±å‡½æ•°ï¼šæœºå™¨çš„"å“å°è¯„åˆ†"</h2>
        
        <div class="paradigm-grid">
            <div class="theory-card">
                <h4>ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ</h4>
                <p><strong>æŸå¤±å‡½æ•°</strong>è¡¡é‡æ¨¡å‹é¢„æµ‹çš„å‡†ç¡®ç¨‹åº¦ã€‚</p>
                <div class="math-formula">
                    \(Loss = \frac{1}{N}\sum (Z_{çœŸå®} - \hat{Z}_{é¢„æµ‹})^2\)
                </div>
                <p>åœ¨çƒ¹é¥ªä¸­ï¼š</p>
                <div class="math-formula">
                    æŸå¤± = å¹³å‡[(æ ‡å‡†å‘³é“ - é¢„æµ‹å‘³é“)Â²]
                </div>
                <p><strong>ç›®æ ‡ï¼šæœ€å°åŒ–æŸå¤±</strong></p>
            </div>
            
            <div class="practice-card">
                <h4>ğŸ”§ è¯„ä¼°æ•ˆæœ</h4>
                
                <div style="text-align: center;" class="compact-section">
                    <div class="compact-section">ä¸å®Œç¾é…æ–¹çš„å·®è·ï¼š</div>
                    <div class="status-value" style="font-size: 1.2em; margin: 4px 0;" id="errorDisplay">0.000</div>
                    <div class="status-display compact-section" id="errorStatus">
                        ç‚¹å‡»è¯„ä¼°å½“å‰é…æ–¹
                    </div>
                    <button id="calculateError" class="compact-button">è¯„ä¼°é…æ–¹</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>3. ä¼˜åŒ–ç®—æ³•ï¼šæœºå™¨çš„"æ™ºèƒ½å­¦ä¹ "</h2>
        
        <div class="paradigm-grid">
            <div class="theory-card">
                <h4>ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ</h4>
                <p><strong>ä¼˜åŒ–ç®—æ³•</strong>æ™ºèƒ½è°ƒæ•´å‚æ•°ä»¥æœ€å°åŒ–æŸå¤±ã€‚</p>
                <p><strong>Adamç®—æ³•</strong>ç‰¹ç‚¹ï¼š</p>
                <div class="algorithm-explanation">
                    â€¢ <strong>è‡ªé€‚åº”æ­¥é•¿</strong>ï¼šæ ¹æ®è¯¯å·®å¤§å°è°ƒæ•´å­¦ä¹ é€Ÿåº¦<br>
                    â€¢ <strong>åŠ¨é‡æ•ˆåº”</strong>ï¼šä¿æŒä¹‹å‰çš„è°ƒæ•´æ–¹å‘<br>
                    â€¢ <strong>è®°å¿†å­¦ä¹ </strong>ï¼šè®°ä½å†å²ç»éªŒï¼Œé¿å…é‡å¤é”™è¯¯
                </div>
                
                <div class="cooking-analogy">
                    <strong>ğŸ‘¨â€ğŸ³ çƒ¹é¥ªç±»æ¯”ï¼šAdamç®—æ³•å°±åƒé¡¶çº§å¨å¸ˆçš„è°ƒå‘³æ™ºæ…§</strong><br>
                    <div class="analogy-item">
                        â€¢ <strong>è‡ªé€‚åº”æ­¥é•¿</strong> â†’ å¨å¸ˆæ ¹æ®"å’¸æ·¡ç¨‹åº¦"å†³å®šåŠ ç›é‡ï¼šå·®å¾—å¤šå°±å¤šåŠ ç‚¹ï¼Œå·®ä¸å¤šå°±å¾®è°ƒ
                    </div>
                    <div class="analogy-item">
                        â€¢ <strong>åŠ¨é‡æ•ˆåº”</strong> â†’ å¨å¸ˆä¿æŒä¹‹å‰çš„è°ƒæ•´æ–¹å‘ï¼šä¸Šæ¬¡åŠ ç›æœ‰æ•ˆï¼Œè¿™æ¬¡ç»§ç»­ç±»ä¼¼æ–¹å‘
                    </div>
                    <div class="analogy-item">
                        â€¢ <strong>è®°å¿†å­¦ä¹ </strong> â†’ å¨å¸ˆè®°ä½å†å²ç»éªŒï¼šé¿å…é‡å¤çŠ¯é”™ï¼Œè¶Šæ¥è¶Šç²¾å‡†
                    </div>
                </div>
            </div>
            
            <div class="practice-card">
                <h4>ğŸ”§ å­¦ä¹ æ–¹æ³•å¯¹æ¯”</h4>
                
                <div class="optimization-comparison">
                    <div class="method random-method">
                        <h5>ğŸ§ª éšæœºå°è¯•æ³•</h5>
                        <div class="method-stats">
                            è€—æ—¶: <span id="randomTime">-</span><br>
                            å°è¯•æ¬¡æ•°: <span id="randomAttempts">-</span><br>
                            æœ€ä½³è¯„åˆ†: <span id="randomBestScore">-</span>
                        </div>
                        <div class="progress-tracker" id="randomProgress">
                            <div class="progress-step">ç­‰å¾…å¼€å§‹...</div>
                        </div>
                        <button id="startRandom">å¼€å§‹å°è¯•</button>
                    </div>
                    
                    <div class="method smart-method">
                        <h5>ğŸš€ æ™ºèƒ½å­¦ä¹ æ³•</h5>
                        <div class="method-stats">
                            è€—æ—¶: <span id="smartTime">-</span><br>
                            å­¦ä¹ æ­¥éª¤: <span id="smartSteps">-</span><br>
                            æœ€ç»ˆè¯„åˆ†: <span id="smartFinalScore">-</span>
                        </div>
                        <div class="progress-tracker" id="smartProgress">
                            <div class="progress-step">ç­‰å¾…å¼€å§‹...</div>
                        </div>
                        <button id="startSmart">å¼€å§‹å­¦ä¹ </button>
                    </div>
                </div>
                
                <div class="status-display" id="optimizationStatus">
                    é€‰æ‹©ä¸€ç§å­¦ä¹ æ–¹æ³•ï¼Œè§‚å¯Ÿå‚æ•°å¦‚ä½•å˜åŒ–
                </div>
                
                <!-- ç‹¬ç«‹çš„ç»“æœæç¤ºè¯­åŒºåŸŸ -->
                <div id="resultMessages"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ¯ å­¦ä¹ æ€»ç»“</h2>
        <div class="summary-box">
            <p><strong>ğŸ¤– æœºå™¨å­¦ä¹ ä¸‰å¤§æ ¸å¿ƒè¦ç´ ï¼š</strong></p>
            <p>â€¢ <strong>å†³ç­–å‡½æ•°</strong>ï¼šå®šä¹‰äº†æœºå™¨å¦‚ä½•æ€è€ƒ â†’ å°±åƒå¨å¸ˆçš„"è°ƒå‘³å…¬å¼"ï¼ˆpÃ—è”¬èœé‡ - qÃ—è‚¥è‚‰é‡ï¼‰</p>
            <p>â€¢ <strong>æŸå¤±å‡½æ•°</strong>ï¼šè¯„ä»·æœºå™¨æ€è€ƒçš„è´¨é‡ â†’ å°±åƒ"å“å°è¯„åˆ†"ï¼Œé‡åŒ–ä¸å®Œç¾å‘³é“çš„å·®è·</p>
            <p>â€¢ <strong>ä¼˜åŒ–ç®—æ³•</strong>ï¼šæ”¹è¿›æœºå™¨æ€è€ƒçš„æ–¹æ³• â†’ å°±åƒ"æ™ºèƒ½è°ƒå‘³"ï¼Œé€šè¿‡Adamç®—æ³•å¿«é€Ÿæ‰¾åˆ°æœ€ä½³é…æ–¹</p>
            
            <div style="margin-top: 12px; padding: 10px; background: #d5f4e6; border-radius: 4px; text-align: center;">
                <p style="font-weight: bold; font-size: 1.1em; margin: 0;">
                    ğŸ“ æœºå™¨å­¦ä¹  = å†³ç­–å‡½æ•° + æŸå¤±å‡½æ•° + ä¼˜åŒ–ç®—æ³•
                </p>
                <p style="font-size: 0.95em; margin: 4px 0 0 0; color: #2c3e50;">
                    é€šè¿‡è¿™ä¸ªçƒ¹é¥ªç±»æ¯”ï¼Œä½ å·²ç†è§£äº†AIæ€ç»´çš„æ ¸å¿ƒåŸç†ï¼
                </p>
            </div>
        </div>
    </div>

<script>
    // é…ç½®å‚æ•° - è°ƒæ•´ç†æƒ³å€¼
    const PERFECT_P = 1.9;  // ç†æƒ³ç›ç”¨é‡
    const PERFECT_Q = 0.9;  // ç†æƒ³é†‹ç”¨é‡

    // åˆå§‹åŒ–å…ƒç´ 
    const pSlider = document.getElementById('pSlider');
    const qSlider = document.getElementById('qSlider');
    const pValue = document.getElementById('pValue');
    const qValue = document.getElementById('qValue');
    const currentScore = document.getElementById('currentScore');
    const tastePrediction = document.getElementById('tastePrediction');
    const errorDisplay = document.getElementById('errorDisplay');
    const errorStatus = document.getElementById('errorStatus');
    const optimizationStatus = document.getElementById('optimizationStatus');
    const recipeStatus = document.getElementById('recipeStatus');
    const resultMessages = document.getElementById('resultMessages');

    // ç»Ÿè®¡å…ƒç´ 
    const randomTime = document.getElementById('randomTime');
    const randomAttempts = document.getElementById('randomAttempts');
    const randomBestScore = document.getElementById('randomBestScore');
    const smartTime = document.getElementById('smartTime');
    const smartSteps = document.getElementById('smartSteps');
    const smartFinalScore = document.getElementById('smartFinalScore');

    let isOptimizing = false;

    // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
    pSlider.addEventListener('input', updateAllDisplays);
    qSlider.addEventListener('input', updateAllDisplays);
    document.getElementById('resetRecipe').addEventListener('click', resetRecipe);
    document.getElementById('calculateError').addEventListener('click', calculateError);
    document.getElementById('startRandom').addEventListener('click', startRandomOptimization);
    document.getElementById('startSmart').addEventListener('click', startSmartOptimization);

    function updateAllDisplays() {
        updateParamDisplay();
        updateTastePrediction();
    }

    function updateParamDisplay() {
        const p = parseFloat(pSlider.value);
        const q = parseFloat(qSlider.value);
        
        pValue.textContent = p.toFixed(2);
        qValue.textContent = q.toFixed(2);
    }

    function updateTastePrediction() {
        const p = parseFloat(pSlider.value);
        const q = parseFloat(qSlider.value);
        
        const pDiff = p - PERFECT_P;
        const qDiff = q - PERFECT_Q;
        const distance = Math.sqrt(pDiff * pDiff + qDiff * qDiff);
        
        let emoji, description, color;
        
        if (distance < 0.15) {
            emoji = 'ğŸ˜‹';
            description = 'å®Œç¾é…æ–¹ï¼å’¸é…¸å¹³è¡¡';
            color = '#27ae60';
        } else if (distance < 0.4) {
            if (Math.abs(pDiff) > Math.abs(qDiff)) {
                if (pDiff > 0) {
                    emoji = 'ğŸ§‚';
                    description = 'å¤ªå’¸äº†';
                    color = '#e74c3c';
                } else {
                    emoji = 'ğŸ’§';
                    description = 'ä¸å¤Ÿå’¸';
                    color = '#3498db';
                }
            } else {
                if (qDiff > 0) {
                    emoji = 'ğŸ‹';
                    description = 'å¤ªé…¸äº†';
                    color = '#e67e22';
                } else {
                    emoji = 'ğŸŒµ';
                    description = 'ä¸å¤Ÿé…¸';
                    color = '#2ecc71';
                }
            }
        } else {
            if (pDiff > 0.5 && qDiff > 0.5) {
                emoji = 'ğŸ˜–';
                description = 'åˆå’¸åˆé…¸ï¼';
                color = '#e74c3c';
            } else if (pDiff < -0.5 && qDiff < -0.5) {
                emoji = 'ğŸ˜';
                description = 'å¤ªæ·¡äº†';
                color = '#95a5a6';
            } else if (pDiff > 0.5) {
                emoji = 'ğŸ§‚';
                description = 'å’¸æ­»äº†ï¼';
                color = '#e74c3c';
            } else if (qDiff > 0.5) {
                emoji = 'ğŸ‹';
                description = 'é…¸æ­»äº†ï¼';
                color = '#e67e22';
            } else if (pDiff < -0.5) {
                emoji = 'ğŸ’§';
                description = 'æ²¡å’¸å‘³';
                color = '#3498db';
            } else if (qDiff < -0.5) {
                emoji = 'ğŸŒµ';
                description = 'æ²¡é…¸å‘³';
                color = '#2ecc71';
            } else {
                emoji = 'ğŸ˜';
                description = 'å‘³é“å¥‡æ€ª';
                color = '#95a5a6';
            }
        }
        
        tastePrediction.textContent = `${description} ${emoji}`;
        tastePrediction.style.background = color;
        tastePrediction.style.color = 'white';
        
        // è¯„åˆ†è®¡ç®—ï¼šæœ€é«˜99åˆ†
        const score = Math.min(99, Math.max(0, 100 - distance * 80));
        currentScore.textContent = score.toFixed(0);
        currentScore.style.color = distance < 0.15 ? '#27ae60' : 
                                 distance < 0.4 ? '#f39c12' : '#e74c3c';
    }

    function calculateError() {
        const p = parseFloat(pSlider.value);
        const q = parseFloat(qSlider.value);
        
        const pDiff = p - PERFECT_P;
        const qDiff = q - PERFECT_Q;
        const distance = Math.sqrt(pDiff * pDiff + qDiff * qDiff);
        const score = Math.min(99, Math.max(0, 100 - distance * 80));
        
        errorDisplay.textContent = distance.toFixed(3);
        errorDisplay.style.color = distance < 0.15 ? '#27ae60' : 
                                 distance < 0.4 ? '#f39c12' : '#e74c3c';
        
        errorStatus.textContent = `è¯„åˆ†ï¼š${score.toFixed(0)}åˆ† (å·®è·ï¼š${distance.toFixed(3)})`;
        errorStatus.style.background = distance < 0.15 ? '#d5f4e6' : 
                                     distance < 0.4 ? '#fef9e7' : '#fdedec';
    }

    function resetRecipe() {
        pSlider.value = 1.0;
        qSlider.value = 1.0;
        updateAllDisplays();
        errorStatus.textContent = 'é…æ–¹å·²é‡ç½®';
        errorStatus.style.background = '#f8f9fa';
    }

    function startOptimization() {
        isOptimizing = true;
        recipeStatus.classList.add('optimizing');
        document.getElementById('startRandom').disabled = true;
        document.getElementById('startSmart').disabled = true;
    }

    function endOptimization() {
        isOptimizing = false;
        recipeStatus.classList.remove('optimizing');
        document.getElementById('startRandom').disabled = false;
        document.getElementById('startSmart').disabled = false;
    }

    // æ›´å¥½çš„éšæœºæ•°ç”Ÿæˆå™¨
    function betterRandom() {
        const array = new Uint32Array(1);
        window.crypto.getRandomValues(array);
        return array[0] / 4294967295; // è½¬æ¢ä¸º0-1ä¹‹é—´çš„æµ®ç‚¹æ•°
    }

    async function startRandomOptimization() {
        startOptimization();
        const progress = document.getElementById('randomProgress');
        progress.innerHTML = '<div class="progress-step">å¼€å§‹éšæœºå°è¯•...</div>';
        optimizationStatus.textContent = 'éšæœºå°è¯•ä¸­...è§‚å¯Ÿç›å’Œé†‹ç”¨é‡çš„å˜åŒ–';
        
        let bestScore = 0;
        let bestP = 1.0, bestQ = 1.0;
        let attempts = 0;
        const startTime = Date.now();
        
        for (let i = 1; i <= 10; i++) {
            attempts++;
            // ä½¿ç”¨çœŸæ­£çš„éšæœºæ•°
            const newP = (0.5 + betterRandom() * 2.0).toFixed(2);
            const newQ = (0.5 + betterRandom() * 2.0).toFixed(2);
            
            pSlider.value = newP;
            qSlider.value = newQ;
            updateAllDisplays();
            
            const distance = Math.sqrt(Math.pow(newP - PERFECT_P, 2) + Math.pow(newQ - PERFECT_Q, 2));
            const score = Math.min(99, Math.max(0, 100 - distance * 80));
            
            let stepClass = '';
            if (score > bestScore) {
                bestScore = score;
                bestP = newP;
                bestQ = newQ;
                stepClass = 'improved';
            } else if (score < 30) {
                stepClass = 'worse';
            }
            
            progress.innerHTML += `<div class="progress-step ${stepClass}">å°è¯•${i}: ç›=${newP} é†‹=${newQ} è¯„åˆ†${score.toFixed(0)}åˆ†</div>`;
            
            progress.scrollTop = progress.scrollHeight;
            await new Promise(resolve => setTimeout(resolve, 800));
        }
        
        const endTime = Date.now();
        const timeUsed = ((endTime - startTime) / 1000).toFixed(1);
        
        pSlider.value = bestP;
        qSlider.value = bestQ;
        updateAllDisplays();
        calculateError();
        
        randomTime.textContent = `${timeUsed}ç§’`;
        randomAttempts.textContent = attempts;
        randomBestScore.textContent = `${bestScore.toFixed(0)}åˆ†`;
        
        // æ·»åŠ éšæœºå°è¯•ç»“æœæç¤ºè¯­ï¼ˆä¸è¦†ç›–ä¹‹å‰çš„ï¼‰
        const randomMessage = document.createElement('div');
        randomMessage.className = 'result-message random-result';
        randomMessage.innerHTML = `ğŸ§ª <strong>éšæœºå°è¯•å®Œæˆ</strong>ï¼šç”¨äº†${attempts}æ¬¡å°è¯•ï¼Œ${timeUsed}ç§’ï¼Œæœ€ä½³è¯„åˆ†ï¼š${bestScore.toFixed(0)}åˆ†`;
        resultMessages.appendChild(randomMessage);
        
        endOptimization();
    }

    async function startSmartOptimization() {
        startOptimization();
        const progress = document.getElementById('smartProgress');
        progress.innerHTML = '<div class="progress-step">å¼€å§‹æ™ºèƒ½å­¦ä¹ ...</div>';
        optimizationStatus.textContent = 'æ™ºèƒ½å­¦ä¹ ä¸­...è§‚å¯Ÿç›å’Œé†‹ç”¨é‡å¦‚ä½•æ™ºèƒ½è°ƒæ•´';
        
        let p = parseFloat(pSlider.value);
        let q = parseFloat(qSlider.value);
        const startTime = Date.now();
        let steps = 0;
        let finalScore = 0;
        
        // æ¨¡æ‹Ÿæ¢¯åº¦ä¸‹é™
        for (let i = 1; i <= 6; i++) {
            steps++;
            
            // è®¡ç®—æ¢¯åº¦ï¼ˆæ–¹å‘ï¼‰
            const gradP = (PERFECT_P - p) * 0.3;
            const gradQ = (PERFECT_Q - q) * 0.3;
            
            // æ›´æ–°å‚æ•°
            p += gradP;
            q += gradQ;
            
            pSlider.value = p.toFixed(2);
            qSlider.value = q.toFixed(2);
            updateAllDisplays();
            
            const distance = Math.sqrt(Math.pow(p - PERFECT_P, 2) + Math.pow(q - PERFECT_Q, 2));
            const score = Math.min(99, Math.max(0, 100 - distance * 80));
            finalScore = score;
            
            progress.innerHTML += `<div class="progress-step ${score > 85 ? 'improved' : 'active'}">æ­¥éª¤${i}: ç›=${p.toFixed(2)} é†‹=${q.toFixed(2)} è¯„åˆ†${score.toFixed(0)}åˆ†</div>`;
            progress.scrollTop = progress.scrollHeight;
            
            // æ·»åŠ å­¦ä¹ è¯´æ˜
            if (i === 1) {
                progress.innerHTML += `<div class="progress-step" style="background: #fff3cd;">ğŸ‘¨â€ğŸ³ å°äº†ä¸€å£ï¼š${p.toFixed(2) > PERFECT_P ? 'å¤ªå’¸äº†ï¼Œå°‘æ”¾ç‚¹ç›' : 'ä¸å¤Ÿå’¸ï¼Œå¤šæ”¾ç‚¹ç›'}</div>`;
            } else if (i === 3) {
                progress.innerHTML += `<div class="progress-step" style="background: #fff3cd;">ğŸ‘¨â€ğŸ³ è®°ä½ç»éªŒï¼šè°ƒæ•´å¹…åº¦æ›´ç²¾å‡†äº†</div>`;
            }
            
            await new Promise(resolve => setTimeout(resolve, 1200));
        }
        
        const endTime = Date.now();
        const timeUsed = ((endTime - startTime) / 1000).toFixed(1);
        
        calculateError();
        
        smartTime.textContent = `${timeUsed}ç§’`;
        smartSteps.textContent = steps;
        smartFinalScore.textContent = `${finalScore.toFixed(0)}åˆ†`;
        
        // æ·»åŠ æ™ºèƒ½å­¦ä¹ ç»“æœæç¤ºè¯­ï¼ˆä¸è¦†ç›–ä¹‹å‰çš„ï¼‰
        const smartMessage = document.createElement('div');
        smartMessage.className = 'result-message smart-result';
        smartMessage.innerHTML = `ğŸš€ <strong>æ™ºèƒ½å­¦ä¹ å®Œæˆ</strong>ï¼šç”¨äº†${steps}ä¸ªæ­¥éª¤ï¼Œ${timeUsed}ç§’ï¼Œæœ€ç»ˆè¯„åˆ†ï¼š${finalScore.toFixed(0)}åˆ†`;
        resultMessages.appendChild(smartMessage);
        
        endOptimization();
    }

    // åˆå§‹åŒ–
    updateAllDisplays();
</script>
<footer style="text-align: center; margin-top: 40px; padding: 20px; border-top: 1px solid #e9ecef; color: #6c757d; font-size: 14px; line-height: 1.5;">
    <p style="margin: 5px 0;">Â© 2025 ä»˜ä½³å…´ã€é©¬è¡é¾™ã€éƒ‘å­æ°åŠAI4S TEEN CAMPç»„å§”ä¼š</p>
    <p style="margin: 5px 0; font-size: 13px;">æœ¬æ•™å­¦ææ–™ä»…ä¾›è¯¾å ‚æ•™å­¦ä¸å­¦æœ¯äº¤æµä½¿ç”¨ï¼Œæœªç»ä¹¦é¢è®¸å¯ï¼Œä¸å¾—ç”¨äºä»»ä½•å•†ä¸šç”¨é€”ã€‚</p>
</footer>
</body>
</html>